/*
 tipJS - OpenSource Javascript MVC Framework ver.2.1.0
 Copyright 2013.08 tipJS-Team
 Dual licensed under the MIT or GPL Version 2 licenses
 Author: SeungHyun PAEK, Hanghee Yi, Juntai Park, Yun Jung Bu
 HomePage: http://tipjs-team.github.io/tipJS/
 GitHub: https://github.com/tipJS-Team/tipJS
 License: MIT, GPL V2
 create date: 2013-10-11 */
!function(a){"use strict";var b={};b.ver=b.version=b.VERSION="2.1.0",a.tipJS=b;for(var c=b.util={},d=Object.prototype.toString,e=["Arguments","Function","Number","String","Date","RegExp","Boolean"],f=function(a){c["is"+a]=function(b){return d.call(b)==="[object "+a+"]"}},g=0,h=e.length;h>g;g++)f(e[g]);c.isArray=Array.isArray||function(a){return"[object Array]"===d.call(a)},c.isObject=function(a){return a===Object(a)},c.toArray=function(a){var b=[];if(a.length)for(var c=0,d=a.length;d>c;c++)b[c]=a[c];return b},c.getById=function(a,b){return b?b.getElementById(a):document.getElementById(a)},c.getByName=function(a,b){return b?b.getElementsByName(a):document.getElementsByName(a)},c.getByTag=function(a,b){return b?b.getElementsByTagName(a):document.getElementsByTagName(a)},c.mergeObject=function(a,b){for(var c in b)a[c]||(a[c]=b[c]);return a},c.cloneObject=function(a,b){if(null==a||"object"!=typeof a)return a;if(b)return i(a);var d=a instanceof Array?[]:{};for(var e in a)d[e]="object"==typeof a[e]?c.cloneObject(a[e],!1):a[e];return d},c.hasChild=function(a){for(var b in a)if("object"==typeof a[b])return!0;return!1},c.uniqArray=function(a){for(var b=[],c=a.length,d=0;c>d;d++){for(var e=d+1;c>e;e++)a[d]===a[e]&&(e=++d);b.push(a[d])}return b},c.loadJS=function(a,b){var d=document.createElement("script");d.type="text/javascript",d.src=S.define?S.define.getNoCacheUrl(a):a,b&&(d.readyState?d.onreadystatechange=function(){("loaded"==this.readyState||"complete"==this.readyState)&&(this.onreadystatechange=null,b(this))}:d.onload=function(){b(this)}),c.getByTag("head")[0].appendChild(d)};var i=function(a){return i=c.isFunction(Object.create)?function(a){return Object.create(a)}:function(a){function b(){}return b.prototype=a,new b},i(a)},j=b.echo=function(a,b,c){if(!c||!("string"!=typeof c||"string"==typeof c&&c.split(".").length+c.split("]").length>3)){if(b||(b=""),null===a||void 0===a)return console.log((c?c+".":"")+a),void 0;if("object"!=typeof a)return(typeof a==b||""===b)&&console.log((c?c+".":"")+a+"["+typeof a+"]"),void 0;a instanceof Array?console.log((c?c+":":"")+"[Array["+a.length+"]]"):console.log((c?c+":":"")+"[Object]");for(var d in a)a instanceof Array?"object"==typeof a[d]?j(a[d],b,(c?c+"[":"[")+d+(c?"]":"]")):(typeof a[d]==b||""===b)&&console.log((c?c+"[":"[")+d+(c?"]":"]")+":"+a[d]+" ("+typeof a[d]+")"):"object"==typeof a[d]?j(a[d],b,(c?c+".":"")+d):(typeof a[d]==b||""===b)&&console.log((c?c+".":"")+d+":"+a[d]+" ("+typeof a[d]+")")}},k=function(a){return"Please define "+a},l=function(a,b){if(c.isArray(a)){for(var d=a.length;d--;)if(a[d]==b)return!0}else if(a==b)return!0;return!1},m=function(a,b){var d=a.__extend;if(!d)return a;if(c.isString(d))a=n(a,d,b);else if(d instanceof Array)for(var e=d.length;e--;)a=n(a,d[e],b);return a},n=function(a,b,d){return"model"==d?c.mergeObject(a,c.cloneObject(t(b))):c.mergeObject(a,c.cloneObject(u(b)))},o=function(){return o=Date.now?function(){return Date.now()}:function(){return(new Date).getTime()},o()},p=function(a,b,c,d){window.addEventListener?(p=function(a,b,c,d){void 0===d&&(d=!1),a.addEventListener(b,c,d)},p(a,b,c,d)):window.attachEvent&&(p=function(a,b,c){a.attachEvent("on"+b,c)},p(a,b,c,d))},q=function(a,d,e){if(!c.isObject(e))throw new Error(k(a));if(!c.isString(d))throw new Error(k(a));if(e.__extend&&"controllers"!=a&&"interceptors"!=a&&l(e.__extend,d))throw new Error("Can't extend itself: "+d);if(!S)throw new Error(k(a));if(S.loadOrder.presentOrder()===a||b.isRelease)switch(a){case"interceptors":case"controllers":case"models":case"views":O[a][d]=e}},r=function(a,d){var e=S.define.path[d],f=a.appPath?a.appPath:".";if("lang"===d&&a.localSet)return a[d]=[f+"/"+e+"/"+b.lang+".js"],a[d];if("tipJSRelease"===d)return a[d]=[f+"/"+S.define.releaseFile],a[d];for(var g=c.uniqArray(a[d]),h=[],i=g.length;i--;)h.push(f+"/"+e+"/"+g[i]);return h},s=function(a){N[a]=N[a]||{};var b=N[a].requireList=r(S.define,a);if(b.length>0)for(var d=b.length;d--;)c.loadJS(b[d],function(b){E(a,b.src)&&D()});else D()},t=function(a,b){var d=O.models;if(!d[a]||void 0===d[a])throw new Error("Can't find model: "+a);if(b===!0){var e=O.syncModels;if(e||(e=O.syncModels={}),e[a])return e[a];var f=e[a]=c.cloneObject(d[a],W["models"+a]);return c.isFunction(f.__init)&&f.__init(),f}var g=c.cloneObject(d[a],W["models"+a]);return c.isFunction(g.__init)&&g.__init(),g},u=function(a){var b=O.views;if(!b||!b[a]||void 0===b[a])throw new Error("Can't find view: "+a);var d=c.cloneObject(b[a],W["views"+a]);return c.isFunction(d.__init)&&d.__init(),d},v=function(){var a,d,e,f=O.controllers;for(a in f)d=c.cloneObject(f[a]),e={controllerName:a,getModel:t,getView:u,render:G,getById:c.getById,getByName:c.getByName,getByTag:c.getByTag},b.action[a]=function(a,d){return function(){var e,f,g=arguments;b.isDevelopment===!0&&(e=o()),S.define.beforeController&&S.define.beforeController.apply(a,arguments)===!1||(f=function(){if(d.exceptionInvoke)try{w(d,g)}catch(f){(g=c.toArray(g)).unshift(f),d.exceptionInvoke.apply(d,g)}else w(d,g);S.define.afterController&&S.define.afterController.apply(a,g),b.isDevelopment===!0&&b.debug(a.controllerName+" completed in "+(o()-e)/1e3+" seconds")},d.async===!0?setTimeout(f,d.delay?d.delay:15):f())}}(e,d)},w=function(a,b){a.beforeInvoke&&a.beforeInvoke.apply(a,b)===!1||a.invoke&&a.invoke.apply(a,b)===!1||a.afterInvoke&&a.afterInvoke.apply(a,b)},x=function(){var a,b,d,e,f,g=O.interceptors;for(var h in g)b=d=e=[],a=g[h],f=a.order?a.order:0,a.target&&(b=c.isArray(a.target)?a.target:[a.target]),a.before&&(d=c.isArray(a.before)?a.before:[a.before]),a.after&&(e=c.isArray(a.after)?a.after:[a.after]),P.push({order:f,scope:b,before:d,after:e});P.sort(function(a,b){return a.order-b.order})},y=function(a,b,c){return function(){for(var d,e=c.before,f=0,g=e.length;g>f;f++)if(d=e[f].apply(b,arguments),void 0!==d)return d;return d=a.apply(b,arguments),void 0!==d?d:void 0}},z=function(a,b,c){return function(){var d,e=c.after;if(d=a.apply(b,arguments),void 0!==d)return d;for(var f=0,g=e.length;g>f;f++)if(d=e[f].apply(b,arguments),void 0!==d)return d}},A=function(a,b,d,e){var f=b.split("."),g=O[a];if(1!=f.length||a!=b&&a+"*"!=b){if(2==f.length&&a==f[0]){var h=f[1];for(var i in g)if(i==h||h.indexOf("*")>0&&0==i.indexOf(h.substr(0,h.indexOf("*")))){var j=g[i];for(var k in j)c.isFunction(j[k])&&(j[k]=e(j[k],j,d))}}else if(3==f.length&&a==f[0]){var h=f[1],l=f[2];for(var i in g)if(i==h){var j=g[i];for(var k in j)(k==l||l.indexOf("*")>0&&0==k.indexOf(l.substr(0,l.indexOf("*"))))&&c.isFunction(j[k])&&(j[k]=e(j[k],j,d))}}}else for(var i in g){var j=g[i];for(var k in j)c.isFunction(j[k])&&(j[k]=e(j[k],j,d))}},B=function(a){for(var b=P.length;b--;)for(var c=P[b],d=c.scope,e=0,f=d.length;f>e;e++)A(a,d[e],c,y);for(var b=0,g=P.length;g>b;b++)for(var c=P[b],d=c.scope,e=0,f=d.length;f>e;e++)A(a,d[e],c,z)},C=function(a){U[a.url]=a.controller,p(window,"hashchange",function(){var a=location.hash;J!=a&&(J=a,0==a.length&&U["/"]?b.action[U["/"]]():U[a]?b.action[U[a]]():U["!"]&&b.action[U["!"]]())})},D=function(){var a,d;if(S.loadOrder.isLastOrder()===!1)return s(S.loadOrder.nextOrder()),void 0;x();var e=O.controllers;if(e){B("controllers");for(a in e)e[a].getModel=t,e[a].getView=u,e[a].render=G,e[a].getById=c.getById,e[a].getByName=c.getByName,e[a].getByTag=c.getByTag;v()}var f=O.models;if(f){B("models");for(a in f)d=a,m(f[a],"model"),d.lastIndexOf("VO")!=d.length-2&&(f[a].getModel=t,f[a].getById=c.getById,f[a].getByName=c.getByName,f[a].getByTag=c.getByTag),W["models"+d]=!c.hasChild(f[a])}var g=O.views;if(g){B("views");for(a in g)d=a,m(g[a],"view"),g[a].getView=u,g[a].render=G,g[a].getById=c.getById,g[a].getByName=c.getByName,g[a].getByTag=c.getByTag,W["views"+d]=!c.hasChild(g[a])}if(b.debug("tipJS version "+b.version+"["+b.lang+"]"),c.isArray(S.onLoadArgs)||(S.onLoadArgs=[]),S.define.onLoad.apply(S.define,S.onLoadArgs),K){for(var h=0,i=K.length;i>h;h++){var j=K[h],k=b.action[j.name];k.apply(k,j.param)}K=null}for(var h=0,l=S.define.routes.length;l>h;h++){var n=S.define.routes[h];C(n)}if(l>0){var o=J=location.hash;0==o.length&&U["/"]?b.action[U["/"]]():U[o]?b.action[U[o]]():U["!"]&&b.action[U["!"]]()}},E=function(a,b){var c,d,e=N[a].requireList;for(c=e.length;c--;)if(e[c]!==!0&&(d=e[c].indexOf("./")>-1?e[c].substr(e[c].lastIndexOf("./")+1):e[c],b.indexOf(d)>-1)){e[c]=!0;break}for(c=e.length;c--;)if(e[c]!==!0)return!1;return!0};b.benchmark={},b.benchmark.mark=function(a){R[a]=o()},b.benchmark.elapsedTime=function(a,c,d){var e=R[a],f=R[c],g=(f-e)/1e3;return d?d(a,c,e,f,g):b.log("elapsed time["+a+" to "+c+"] : "+g+" seconds","[BENCHMARK]"),g};var F=function(){var a=!1;if(window.XMLHttpRequest)a=new XMLHttpRequest;else if(window.ActiveXObject)try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){}}return F=function(){return a},F()},G=b.render=function(a){var b;if(arguments.length>1)return H(arguments[0],arguments[1],arguments[2]);if(S.define.templateCache&&V[a.url])return b=H(V[a.url],a.data,a.tplId),c.isString(a.renderTo)&&(c.getById(a.renderTo).innerHTML+=b),b;var d=F();d.open("GET",S.define.getNoCacheUrl(a.url),!1);try{d.send(null)}catch(e){return null}if(4==d.readyState&&200==d.status)return b=V[a.url]=d.responseText,b=H(b,a.data,a.tplId),c.isString(a.renderTo)&&(c.getById(a.renderTo).innerHTML+=b),b;throw new Error("Can't find templates file: "+a.url)},H=function(a,b,d){if(a=a.replace(/\r\n/g,"\n"),a=a.replace(/\r/g,"\n"),a=a.replace(/\\/g,"\\\\"),a=a.replace(/\n/g,""),c.isString(d)){for(var e=a.split("[[#"),f=new RegExp("^"+d+"]]"),g=0,h=e.length;h>g;g++)if(e[g].match(f)){a=e[g].replace(f,"");break}}else a=a.replace(/\[\[#[a-zA-Z0-9_-]*\]\]/g,"");var i=a.split("@>"),j=new Function("data",I(i));return j(b)},I=function(a){var b,c,d,e,f=[],g=[],h=[],i="PLN",j="VAL",k="PAS",l="__tempArr__.push(";for(f.push("var __tempArr__ = [];"),b=0,c=a.length;c>b;b++)d=a[b],d.indexOf("<@=")>-1?(e=d.split("<@="),e.length>1?(h.push(e[0].replace(/"/g,'\\"')),h.push(e[1]),g.push(i),g.push(j)):(h.push(e[0]),g.push(j))):d.indexOf("<@")>-1?(e=d.split("<@"),e.length>1?(h.push(e[0].replace(/"/g,'\\"')),h.push(e[1]),g.push(i),g.push(k)):(h.push(e[0]),g.push(k))):(h.push(d.replace(/"/g,'\\"')),g.push(i));for(b=0,c=h.length;c>b;b++)d=h[b],g[b]==j?(d='""+'+d+'+""',f.push(l+d+");")):g[b]==k?f.push(d):(d='"'+d+'"',f.push(l+d+");"));return f.push("return __tempArr__.join('');"),f.join("")};b.log=function(a,b){window.console=window.console||{log:function(){},error:function(){}};var c=new Date,d=c.getFullYear(),e=c.getMonth()+1,f=c.getDate(),g=c.getHours(),h=c.getMinutes(),i=c.getSeconds(),j=c.getMilliseconds();console.log((b?b:"")+d+"/"+e+"/"+f+" "+g+":"+h+":"+i+"."+j+" "+a)},b.debug=function(a){b.isDevelopment&&b.log(a,"[DEBUG]")},b.localSet=function(a){"lang"===S.loadOrder.presentOrder()&&(T=a)},b.msg=function(a){return T[a]?T[a]:a},b.interceptor=function(a,b){q("interceptors",a,b)},b.controller=function(a,b){q("controllers",a,b)},b.model=function(a,b){q("models",a,b)},b.view=function(a,b){q("views",a,b)},b.action=function(a){var d,e;if(!arguments.length)return b.action;var f=arguments[0],g=c.toArray(arguments).slice(1);if(d=f.split("."),0==a.length)throw new Error("tipJS.action : invalid parameter");return S.loadOrder&&S.loadOrder.isLastOrder()?(e=b.action[a],e.apply(e,g),void 0):(K=K||[],K.push({name:f,param:g}),void 0)},b.loadApp=function(){if(L){var a=c.toArray(arguments);a.length&&(S.onLoadArgs=a),M(),delete b.loadApp}},b.app=function(a){L=a};var J,K,L,M=function(){var a=L;if(c.mergeObject(a,Q.define),null===b.isDevelopment){for(var d=a.developmentHostList.length;d--;)if(null!==X.hostname.match(a.developmentHostList[d])){b.isDevelopment=!0;break}if(!b.isDevelopment)for(var d=a.releaseHostList.length;d--;)if(null!==X.hostname.match(a.releaseHostList[d])){b.isRelease=!0;break}}S.define=a,c.mergeObject(S.loadOrder={},Q.loadOrder),b.isRelease&&(S.loadOrder.order=["lang","tipJSRelease"]),s(S.loadOrder.presentOrder())},N={},O={interceptors:{},controllers:{},models:{},views:{}},P=[],Q={define:{noCache:!1,noCacheVersion:b.ver,noCacheParam:"tipJS",noCacheAuto:!1,getNoCacheUrl:function(a){return this.noCache===!1?a:(a+=a.indexOf("?")<0?"?":"&",a+=this.noCacheParam+"="+(this.noCacheAuto===!0?""+Math.random():this.noCacheVersion))},templateCache:!0,path:{lang:"lang",interceptors:"interceptors",controllers:"controllers",models:"models",views:"views"},releaseFile:"tipJSFile.js",developmentHostList:[],releaseHostList:[],lang:[],interceptors:[],controllers:[],models:[],views:[],routes:[],localSet:!1,onLoad:function(){},beforeController:function(){},afterController:function(){},getModel:t,getView:u},loadOrder:{index:0,presentOrder:function(){return this.order[this.index]},nextOrder:function(){return this.order[++this.index]},isLastOrder:function(){return this.index+1==this.order.length},order:["lang","interceptors","controllers","models","views"]}},R={},S={},T={},U={},V={},W={},X=window.location,Y=X.pathname,Z=X.search,$=null,_=(navigator.language||navigator.systemLanguage||navigator.userLanguage).substr(0,2);(null!==Z.match("(\\?|&)debug")||null!==Y.match("debug"))&&($=!0),b.lang=_,b.isDevelopment=$}(this);